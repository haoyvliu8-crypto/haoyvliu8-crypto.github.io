<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
  <title>ç‰ç’ƒÂ·å›¾ç‰‡ â‡„ Base64 è½¬æ¢å™¨</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    }

    body {
      min-height: 100vh;
      background: linear-gradient(145deg, #d9e9fa 0%, #c1d9f0 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
      position: relative;
      overflow-x: hidden;
    }

    /* è£…é¥°æ€§èƒŒæ™¯å…ƒç´  */
    body::before {
      content: '';
      position: absolute;
      width: 300px;
      height: 300px;
      background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.4) 0%, rgba(205, 230, 255, 0.2) 70%);
      border-radius: 50%;
      top: -100px;
      left: -100px;
      z-index: 0;
      filter: blur(60px);
    }

    body::after {
      content: '';
      position: absolute;
      width: 400px;
      height: 400px;
      background: radial-gradient(circle at 70% 80%, rgba(200, 225, 255, 0.5) 0%, rgba(160, 200, 240, 0.2) 80%);
      border-radius: 50%;
      bottom: -150px;
      right: -100px;
      z-index: 0;
      filter: blur(80px);
    }

    .glass-container {
      max-width: 1100px;
      width: 100%;
      background: rgba(255, 255, 255, 0.3);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      border-radius: 3.5rem;
      box-shadow: 0 35px 68px -20px rgba(40, 70, 110, 0.4), inset 0 1px 4px rgba(255, 255, 255, 0.8);
      padding: 2.5rem 2.2rem;
      border: 1px solid rgba(255, 255, 255, 0.6);
      z-index: 10;
      transition: all 0.3s ease;
    }

    h1 {
      font-size: 2.8rem;
      font-weight: 700;
      letter-spacing: -1px;
      background: linear-gradient(140deg, #1d3e64, #29638f, #3b7bb3);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      display: inline-flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 0.25rem;
      line-height: 1.2;
    }

    h1 span {
      font-size: 2.8rem;
      background: none;
      color: #3b77a6;
      filter: drop-shadow(0 4px 6px rgba(30, 70, 120, 0.2));
    }

    .sub {
      font-size: 1.1rem;
      color: #2f557b;
      margin-bottom: 2rem;
      padding-left: 1rem;
      border-left: 5px solid #5290c9;
      background: linear-gradient(to right, rgba(90, 150, 220, 0.1), transparent);
      border-radius: 0 2rem 2rem 0;
      line-height: 1.5;
      font-weight: 400;
      backdrop-filter: blur(2px);
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      margin: 2rem 0 1.5rem;
    }

    @media (max-width: 700px) {
      .grid {
        grid-template-columns: 1fr;
        gap: 2.5rem;
      }
      h1 { font-size: 2.2rem; }
      .glass-container { padding: 1.8rem; }
    }

    .card {
      background: rgba(255, 255, 255, 0.5);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-radius: 2.5rem;
      padding: 1.8rem 1.6rem;
      box-shadow: 0 20px 40px -12px rgba(20, 50, 80, 0.25), inset 0 1px 2px white;
      border: 1px solid rgba(255, 255, 255, 0.7);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .card:hover {
      transform: translateY(-6px);
      box-shadow: 0 30px 55px -12px rgba(25, 70, 120, 0.35);
    }

    .card h2 {
      font-size: 1.7rem;
      font-weight: 600;
      color: #1c3e5e;
      margin-bottom: 1.3rem;
      display: flex;
      align-items: center;
      gap: 8px;
      border-bottom: 2px solid rgba(70, 130, 200, 0.3);
      padding-bottom: 0.6rem;
    }

    .upload-area {
      background: rgba(235, 245, 255, 0.7);
      border-radius: 2rem;
      padding: 1.4rem;
      text-align: center;
      border: 2px dashed rgba(60, 120, 190, 0.4);
      transition: 0.25s;
      margin-bottom: 1.3rem;
      backdrop-filter: blur(6px);
    }

    .upload-area:hover {
      background: rgba(245, 250, 255, 0.9);
      border-color: #4f8ec9;
    }

    .file-label {
      background: white;
      padding: 0.7rem 2rem;
      border-radius: 40px;
      font-weight: 550;
      color: #1e4f7a;
      cursor: pointer;
      display: inline-block;
      box-shadow: 0 8px 18px -6px rgba(30, 80, 140, 0.25);
      border: 1px solid rgba(120, 170, 230, 0.5);
      transition: 0.15s;
      font-size: 1rem;
    }

    .file-label:hover {
      background: #f0f8ff;
      border-color: #357ec7;
      transform: scale(1.02);
    }

    input[type="file"] { display: none; }

    .preview {
      min-height: 140px;
      background: rgba(240, 248, 255, 0.5);
      border-radius: 1.8rem;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.8rem;
      margin: 1rem 0 0.8rem;
      backdrop-filter: blur(4px);
      border: 1px solid rgba(255, 255, 255, 0.6);
    }

    .preview img {
      max-width: 100%;
      max-height: 160px;
      border-radius: 1.2rem;
      box-shadow: 0 12px 22px -10px rgba(20, 40, 70, 0.3);
      object-fit: contain;
      background: #fff;
    }

    .placeholder {
      color: #4f6f92;
      font-size: 1rem;
      padding: 2rem;
      font-style: italic;
      opacity: 0.8;
    }

    textarea {
      width: 100%;
      padding: 1rem 1.2rem;
      font-size: 0.9rem;
      line-height: 1.5;
      background: rgba(255, 255, 255, 0.7);
      border: 2px solid rgba(60, 120, 180, 0.25);
      border-radius: 1.8rem;
      box-shadow: inset 0 4px 10px rgba(0, 0, 0, 0.02);
      resize: vertical;
      font-family: 'SF Mono', 'Fira Code', monospace;
      transition: 0.2s;
      backdrop-filter: blur(4px);
    }

    textarea:focus {
      outline: none;
      border-color: #4380c0;
      background: white;
      box-shadow: 0 0 0 5px rgba(70, 140, 210, 0.2);
    }

    .btn-group {
      display: flex;
      flex-wrap: wrap;
      gap: 0.7rem;
      margin-top: 1rem;
      align-items: center;
    }

    .btn {
      background: white;
      border: 1px solid #b5d0ec;
      padding: 0.7rem 1.5rem;
      border-radius: 40px;
      font-weight: 550;
      font-size: 0.95rem;
      color: #1d4670;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 6px 12px -6px rgba(30, 60, 100, 0.2);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      backdrop-filter: blur(2px);
    }

    .btn-primary {
      background: #1d4b7c;
      border-color: #0d2d4e;
      color: white;
      box-shadow: 0 12px 22px -10px #1d4b7c;
    }

    .btn-primary:hover {
      background: #26659c;
      border-color: #123b60;
      transform: translateY(-3px);
      box-shadow: 0 18px 30px -10px #1e4f82;
    }

    .btn:hover {
      background: #ecf5ff;
      border-color: #78abdf;
      transform: translateY(-2px);
    }

    .btn:active {
      transform: translateY(1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .copy-btn {
      background: #e5f0ff;
      border-color: #9ab9e3;
    }

    .footer-note {
      margin-top: 2.2rem;
      text-align: center;
      padding: 0.7rem 1.5rem;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 60px;
      backdrop-filter: blur(12px);
      font-size: 0.9rem;
      color: #2d5980;
      border: 1px solid rgba(255,255,255,0.6);
      display: inline-block;
      width: auto;
      margin-left: auto;
      margin-right: auto;
    }

    .hint {
      font-size: 0.8rem;
      color: #38658f;
      margin-top: 0.3rem;
      min-height: 1.5rem;
    }

    .error-tip {
      color: #b34242;
      font-weight: 450;
    }

    .success-tip {
      color: #1f7840;
    }

    hr {
      border: none;
      height: 1px;
      background: linear-gradient(to right, transparent, rgba(90, 140, 200, 0.3), transparent);
      margin: 0.8rem 0;
    }

    /* å›¾æ ‡å¾®è°ƒ */
    .icon {
      font-size: 1.2rem;
    }
  </style>
</head>
<body>
<div class="glass-container">
  <h1>
    <span>ğŸ–¼ï¸</span> å›¾ç‰‡ â‡„ Base64 <span>âœ¨</span>
  </h1>
  <div class="sub">ç‰ç’ƒè´¨æ„Ÿ Â· æ‹–æ‹½ä¸Šä¼  Â· ä¸€é”®å¤åˆ¶ä¸‹è½½</div>

  <div class="grid">
    <!-- å·¦ä¾§ï¼šå›¾ç‰‡ â†’ Base64 -->
    <div class="card">
      <h2><span class="icon">ğŸ“¤</span> å›¾ç‰‡è½¬Base64</h2>
      <div class="upload-area">
        <label for="imageUpload" class="file-label">ğŸ“ é€‰æ‹©å›¾ç‰‡ (PNG/JPG/GIF/WEBP)</label>
        <input type="file" id="imageUpload" accept="image/png, image/jpeg, image/gif, image/webp, image/bmp, image/svg+xml">
        <div class="preview" id="previewOriginal">
          <div class="placeholder">é¢„è§ˆåŒº</div>
        </div>
      </div>
      <label for="base64Output" style="font-weight: 550; color: #1b4a73;">ğŸ“‹ Data URL ç»“æœ</label>
      <textarea id="base64Output" rows="3" placeholder="ä¸Šä¼ å›¾ç‰‡åè‡ªåŠ¨ç”Ÿæˆ..." readonly></textarea>
      <div class="btn-group">
        <button class="btn copy-btn" id="copyBase64Btn"><span>ğŸ“‹</span> å¤åˆ¶Base64</button>
        <button class="btn" id="clearLeftBtn"><span>ğŸ—‘ï¸</span> æ¸…ç©º</button>
      </div>
      <div class="hint" id="leftHint">âœ¨ ä¸Šä¼ å›¾ç‰‡ç«‹å³è½¬æ¢ï¼ŒåŒ…å«MIMEå¤´éƒ¨</div>
    </div>

    <!-- å³ä¾§ï¼šBase64 â†’ å›¾ç‰‡ -->
    <div class="card">
      <h2><span class="icon">ğŸ“¥</span> Base64è½¬å›¾ç‰‡</h2>
      <label for="base64Input" style="font-weight: 550; color: #1b4a73;">ğŸ”¤ ç²˜è´´Data URLæˆ–çº¯Base64</label>
      <textarea id="base64Input" rows="3" placeholder="ä¾‹å¦‚: data:image/png;base64,iVBOR... æˆ– çº¯Base64å­—ç¬¦ä¸²"></textarea>
      <div class="preview" id="previewFromBase64">
        <img id="decodedImage" src="" alt="é¢„è§ˆå›¾" style="display: none;">
        <div class="placeholder" id="previewPlaceholder">é¢„è§ˆåŒº</div>
      </div>
      <div class="btn-group">
        <button class="btn-primary btn" id="showImageBtn"><span>ğŸ”</span> é¢„è§ˆå›¾ç‰‡</button>
        <button class="btn" id="downloadImageBtn"><span>â¬‡ï¸</span> ä¸‹è½½å›¾ç‰‡</button>
        <button class="btn" id="clearRightBtn"><span>ğŸ§¹</span> æ¸…ç©º</button>
      </div>
      <div class="hint" id="decodeHint"></div>
    </div>
  </div>

  <div class="footer-note">
    âš¡ çº¯Base64é»˜è®¤ä»¥PNGé¢„è§ˆ/ä¸‹è½½ Â· ç‚¹å‡»æŒ‰é’®å³å“åº” Â· å…¨å±æ¯›ç»ç’ƒæ•ˆæœ
  </div>
</div>

<script>
  (function() {
    // å·¦ä¾§å…ƒç´ 
    const fileInput = document.getElementById('imageUpload');
    const previewOriginal = document.getElementById('previewOriginal');
    const base64Output = document.getElementById('base64Output');
    const copyBase64Btn = document.getElementById('copyBase64Btn');
    const clearLeftBtn = document.getElementById('clearLeftBtn');
    const leftHint = document.getElementById('leftHint');

    // å³ä¾§å…ƒç´ 
    const base64Input = document.getElementById('base64Input');
    const showImageBtn = document.getElementById('showImageBtn');
    const downloadBtn = document.getElementById('downloadImageBtn');
    const clearRightBtn = document.getElementById('clearRightBtn');
    const decodedImage = document.getElementById('decodedImage');
    const previewPlaceholder = document.getElementById('previewPlaceholder');
    const decodeHint = document.getElementById('decodeHint');

    // ---------- å·¦ä¾§åŠŸèƒ½ ----------
    fileInput.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;

      if (!file.type.startsWith('image/')) {
        alert('è¯·é€‰æ‹©ä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶');
        fileInput.value = '';
        return;
      }

      const reader = new FileReader();
      reader.onload = function(ev) {
        const dataURL = ev.target.result;
        base64Output.value = dataURL;

        // é¢„è§ˆ
        previewOriginal.innerHTML = '';
        const img = document.createElement('img');
        img.src = dataURL;
        img.alt = 'preview';
        img.onload = () => {};
        img.onerror = () => {
          previewOriginal.innerHTML = '<div class="placeholder">âŒ é¢„è§ˆå¤±è´¥</div>';
        };
        previewOriginal.appendChild(img);
        leftHint.innerText = 'âœ… å›¾ç‰‡å·²è½¬æ¢ï¼ŒBase64å·²å°±ç»ª';
      };
      reader.readAsDataURL(file);
    });

    copyBase64Btn.addEventListener('click', function() {
      if (!base64Output.value) {
        leftHint.innerText = 'âš ï¸ æ²¡æœ‰å†…å®¹å¯å¤åˆ¶';
        return;
      }
      base64Output.select();
      try {
        const ok = document.execCommand('copy');
        if (ok) {
          const original = copyBase64Btn.innerHTML;
          copyBase64Btn.innerHTML = '<span>âœ…</span> å·²å¤åˆ¶';
          setTimeout(() => { copyBase64Btn.innerHTML = original; }, 1300);
          leftHint.innerText = 'ğŸ“‹ å¤åˆ¶æˆåŠŸï¼';
        } else {
          leftHint.innerText = 'âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶';
        }
      } catch (err) {
        leftHint.innerText = 'âŒ å¤åˆ¶å¼‚å¸¸';
      }
    });

    clearLeftBtn.addEventListener('click', function() {
      fileInput.value = '';
      base64Output.value = '';
      previewOriginal.innerHTML = '<div class="placeholder">é¢„è§ˆåŒº</div>';
      leftHint.innerText = 'âœ¨ å·²æ¸…ç©º';
    });

    // ---------- å³ä¾§åŠŸèƒ½ ----------
    function buildDataURL(input) {
      const trimmed = input.trim();
      if (!trimmed) return null;
      // å¦‚æœå·²ç»æ˜¯ data:image å¼€å¤´
      if (/^data:image\/[a-z+.-]+;base64,/.test(trimmed)) {
        return trimmed;
      }
      // çº¯ base64 (ç§»é™¤ç©ºç™½)
      const clean = trimmed.replace(/\s/g, '');
      if (/^[A-Za-z0-9+/=]+$/.test(clean)) {
        return 'data:image/png;base64,' + clean;
      }
      return null;
    }

    function updatePreview() {
      const raw = base64Input.value;
      const dataURL = buildDataURL(raw);
      if (!dataURL) {
        decodedImage.style.display = 'none';
        previewPlaceholder.style.display = 'flex';
        previewPlaceholder.innerText = 'â›” æ— æ•ˆçš„Base64';
        decodeHint.innerText = 'âŒ æ— æ³•è¯†åˆ«ï¼šéœ€è¦Data URLæˆ–çº¯Base64';
        return;
      }

      decodedImage.onload = () => {
        decodedImage.style.display = 'block';
        previewPlaceholder.style.display = 'none';
        decodeHint.innerText = 'âœ… å›¾ç‰‡åŠ è½½æˆåŠŸ';
      };
      decodedImage.onerror = () => {
        decodedImage.style.display = 'none';
        previewPlaceholder.style.display = 'flex';
        previewPlaceholder.innerText = 'ğŸ–¼ï¸ å›¾ç‰‡æ— æ³•æ˜¾ç¤ºï¼ˆæ ¼å¼æŸåï¼‰';
        decodeHint.innerText = 'âŒ åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ•°æ®';
      };
      decodedImage.src = dataURL;
    }

    showImageBtn.addEventListener('click', updatePreview);

    downloadBtn.addEventListener('click', function() {
      const raw = base64Input.value;
      const dataURL = buildDataURL(raw);
      if (!dataURL) {
        decodeHint.innerText = 'âŒ æ— æ³•ä¸‹è½½ï¼šæ— æ•ˆBase64';
        return;
      }

      let mime = 'image/png';
      let b64Data = '';
      const match = dataURL.match(/^data:(image\/[a-z+.-]+);base64,(.*)$/i);
      if (match) {
        mime = match[1];
        b64Data = match[2];
      } else {
        // ç†è®ºä¸Š buildDataURL ä¼šè¿”å›å¸¦å¤´çš„ï¼Œä½†ä»¥é˜²ä¸‡ä¸€
        const fallback = dataURL.match(/;base64,(.*)$/);
        if (fallback) b64Data = fallback[1];
        else {
          decodeHint.innerText = 'âŒ æ— æ³•è§£æå›¾ç‰‡æ•°æ®';
          return;
        }
      }

      try {
        const byteChars = atob(b64Data);
        const byteArray = new Uint8Array(byteChars.length);
        for (let i = 0; i < byteChars.length; i++) {
          byteArray[i] = byteChars.charCodeAt(i);
        }
        const blob = new Blob([byteArray], { type: mime });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        const ext = mime.split('/')[1] || 'png';
        a.download = `image.${ext}`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        decodeHint.innerText = `âœ… ä¸‹è½½å·²å¼€å§‹ (${mime})`;
      } catch (e) {
        decodeHint.innerText = 'âŒ ä¸‹è½½å¤±è´¥: ' + e.message;
      }
    });

    clearRightBtn.addEventListener('click', function() {
      base64Input.value = '';
      decodedImage.style.display = 'none';
      previewPlaceholder.style.display = 'flex';
      previewPlaceholder.innerText = 'é¢„è§ˆåŒº';
      decodeHint.innerText = '';
    });

    // åˆå§‹åŒ–å³ä¾§é¢„è§ˆå ä½
    previewPlaceholder.innerText = 'é¢„è§ˆåŒº';
  })();
</script>
</body>
</html>